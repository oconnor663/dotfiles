#! /bin/bash

handle_ctrl_c() {
  for job in `jobs -p`; do
    kill $job
  done
}

trap 'handle_ctrl_c' EXIT

adb start-server

for SERIAL in $(adb devices | grep -v List | cut -f 1); do
  # Run the command on each device, and prefix every line of
  # output with the device id.
  (adb -s $SERIAL $@ | sed "s/^/$SERIAL: /") &
done

for job in `jobs -p`; do
  wait $job
done
